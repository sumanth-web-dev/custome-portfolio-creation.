<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Portfolio Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --accent: #06b6d4;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0f4ff 0%, #f8fafc 100%);
        }

        .sidebar {
            background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
            box-shadow: 0 0 40px rgba(99, 102, 241, 0.1);
            border-right: 1px solid rgba(99, 102, 241, 0.1);
        }

        .form-section {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
            border: 1px solid rgba(99, 102, 241, 0.1);
            transition: all 0.3s ease;
        }

        .form-section:hover {
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.08);
            transform: translateY(-2px);
        }

        .form-section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(99, 102, 241, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--gray-200);
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: var(--gray-50);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            background: white;
        }

        .template-option {
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .template-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .template-option.selected {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        /* Enhanced Skills Section Styles */
        .skills-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            min-height: 60px;
            padding: 16px;
            background: var(--gray-50);
            border-radius: 12px;
            border: 1px dashed var(--gray-200);
            transition: all 0.3s ease;
        }

        .skills-container.empty {
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='12' ry='12' stroke='%23D1D5DB' stroke-width='2' stroke-dasharray='6%2c 8' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .skills-container.empty::before {
            content: "No skills added yet. Start adding your skills below!";
            color: var(--gray-400);
            font-style: italic;
            text-align: center;
            padding: 10px;
        }

        .skill-tag {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            margin: 4px;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(99, 102, 241, 0.2);
            animation: fadeIn 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .skill-tag::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .skill-tag:hover::before {
            left: 100%;
        }

        .skill-tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(99, 102, 241, 0.3);
        }

        .skill-tag .skill-name {
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .skill-tag .remove-skill {
            margin-left: 8px;
            cursor: pointer;
            opacity: 0.8;
            background: rgba(255,255,255,0.2);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .skill-tag .remove-skill:hover {
            opacity: 1;
            transform: scale(1.1);
            background: rgba(255,255,255,0.3);
        }

        .skill-input-container {
            display: flex;
            gap: 10px;
            margin-top: 16px;
            position: relative;
        }

        .skill-input {
            flex-grow: 1;
            padding: 12px 16px;
            border: 1px solid var(--gray-200);
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        .skill-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .add-skill-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(99, 102, 241, 0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .add-skill-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(99, 102, 241, 0.4);
        }

        .add-skill-btn:active {
            transform: translateY(0);
        }

        .add-skill-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .skill-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 10;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        .skill-suggestion {
            padding: 10px 16px;
            cursor: pointer;
            transition: background 0.2s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .skill-suggestion:hover {
            background: var(--gray-50);
        }

        .skill-suggestion i {
            color: var(--primary);
        }

        .skill-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 16px;
        }

        .skill-category {
            padding: 6px 12px;
            background: var(--gray-100);
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            color: var(--gray-700);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .skill-category:hover {
            background: var(--primary-light);
            color: white;
        }

        .skill-category.active {
            background: var(--primary);
            color: white;
        }

        .skill-level {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .skill-level-label {
            font-size: 12px;
            color: var(--gray-600);
        }

        .skill-level-bars {
            display: flex;
            gap: 2px;
        }

        .skill-level-bar {
            width: 12px;
            height: 4px;
            background: var(--gray-300);
            border-radius: 2px;
            transition: all 0.2s ease;
        }

        .skill-level-bar.active {
            background: var(--primary);
        }

        .skills-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--gray-200);
            font-size: 12px;
            color: var(--gray-600);
        }

        .file-upload-area {
            border: 2px dashed var(--gray-300);
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
            background: var(--gray-50);
            cursor: pointer;
        }

        .file-upload-area:hover {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.03);
        }

        .file-upload-area.dragover {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.08);
            transform: scale(1.02);
        }

        .preview-frame {
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            background: white;
        }

        .save-button {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border: none;
            color: white;
            padding: 14px 24px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .save-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4);
        }

        .save-button:active {
            transform: translateY(0);
        }

        .save-button.saving {
            opacity: 0.8;
            pointer-events: none;
        }

        .save-button.success {
            background: linear-gradient(135deg, var(--success) 0%, #34d399 100%);
        }

        .save-button.error {
            background: linear-gradient(135deg, var(--error) 0%, #f87171 100%);
        }

        .status-message {
            text-align: center;
            font-size: 14px;
            margin-top: 10px;
            min-height: 20px;
            transition: all 0.3s ease;
        }

        .status-message.success {
            color: var(--success);
        }

        .status-message.error {
            color: var(--error);
        }

        .helper-text {
            font-size: 12px;
            color: var(--gray-500);
            margin-top: 4px;
        }

        .helper-text.info {
            color: var(--primary);
        }

        .counter {
            font-size: 12px;
            text-align: right;
            color: var(--gray-500);
        }

        .counter.warning {
            color: var(--warning);
        }

        .counter.error {
            color: var(--error);
        }

        .section-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: var(--primary);
            color: white;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
        }

        .scroll-indicator {
            position: fixed;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 10;
        }

        .scroll-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--gray-300);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .scroll-dot.active {
            background: var(--primary);
            transform: scale(1.3);
        }

        .scroll-dot:hover {
            background: var(--primary-light);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .pulse {
            animation: pulse 0.5s ease;
        }

        .shake {
            animation: shake 0.5s ease;
        }

        @media (max-width: 1024px) {
            .flex.h-screen {
                flex-direction: column;
            }
            
            .sidebar, main {
                width: 100%;
            }
            
            .sidebar {
                max-height: 50vh;
                overflow-y: auto;
            }
            
            main {
                height: 50vh;
            }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Scroll Indicator -->
    <div class="scroll-indicator">
        <div class="scroll-dot active" data-section="public-url"></div>
        <div class="scroll-dot" data-section="template"></div>
        <div class="scroll-dot" data-section="personal"></div>
        <div class="scroll-dot" data-section="skills"></div>
        <div class="scroll-dot" data-section="contact"></div>
        <div class="scroll-dot" data-section="project1"></div>
        <div class="scroll-dot" data-section="project2"></div>
        <div class="scroll-dot" data-section="project3"></div>
    </div>

    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="w-1/3 sidebar p-8 overflow-y-auto">
            <div class="flex justify-between items-center mb-8">
                 <h1 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                     <i class="fas fa-palette text-indigo-500"></i>
                     Portfolio Editor
                 </h1>
                 <a href="#" class="text-sm text-indigo-600 hover:text-indigo-800 font-medium flex items-center gap-1">
                     <i class="fas fa-sign-out-alt"></i>
                     Logout
                 </a>
            </div>

            <!-- Public URL Section -->
            <div id="public-url" class="mb-6 p-6 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl border border-indigo-100 shadow-sm relative">
                <div class="absolute -top-2 -left-2 section-indicator">
                    <i class="fas fa-link"></i>
                </div>
                <div class="flex items-center gap-3 mb-2">
                    <i class="fas fa-globe text-indigo-500"></i>
                    <h3 class="text-sm font-semibold text-gray-700">Your Public Portfolio</h3>
                </div>
                <p class="text-sm text-gray-600 mb-2">Share your portfolio with this URL:</p>
                <div class="flex items-center gap-2">
                    <a href="#" target="_blank"
                       class="flex-grow font-medium text-indigo-700 break-words hover:text-indigo-800 bg-white px-4 py-2 rounded-lg border border-indigo-100 transition-all duration-300 hover:shadow-sm">
                        https://portfolio-builder.com/johndoe
                    </a>
                    <button onclick="copyToClipboard('https://portfolio-builder.com/johndoe')"
                            class="p-2 text-gray-500 hover:text-indigo-600 bg-white rounded-lg border border-indigo-100 transition-colors hover:shadow-sm"
                            title="Copy URL">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
            </div>

            <!-- Template Selector -->
            <div id="template-section" class="mb-8 form-section">
                <div class="absolute -top-2 -left-2 section-indicator">
                    <i class="fas fa-palette"></i>
                </div>
                <h2 class="form-section-title">
                    <i class="fas fa-palette text-indigo-500"></i>
                    Select a Template
                </h2>
                <div id="template-selector" class="grid grid-cols-3 gap-4">
                    <!-- Templates will be dynamically added here -->
                </div>
                <!-- Hidden input to store selected template -->
                <input type="hidden" id="template" name="template" value="1">
            </div>

            <!-- Portfolio Form -->
            <form id="portfolio-form" class="space-y-6">
                 <!-- Hidden fields for file URLs -->
                <input type="hidden" id="profile_pic" value="">
                <input type="hidden" id="resume_file" value="">

                <!-- Section: Personal Info -->
                <div id="personal" class="form-section relative">
                    <div class="absolute -top-2 -left-2 section-indicator">
                        1
                    </div>
                    <h2 class="form-section-title">
                        <i class="fas fa-user text-indigo-500"></i>
                        Personal Info
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="col-span-2 sm:col-span-1">
                            <label for="profile_pic_upload" class="form-label flex items-center gap-2">
                                <i class="fas fa-image text-indigo-500"></i>
                                Profile Picture
                            </label>
                            <div class="file-upload-area" id="profile-pic-area">
                                <div class="flex flex-col items-center gap-4">
                                    <div class="group relative w-32 h-32 rounded-2xl overflow-hidden shadow-sm hover:shadow-md transition-all duration-300">
                                        <img id="profile_pic_preview" src="" 
                                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOCAxMjgiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iNjQiIGN5PSI0OCIgcj0iMjQiIGZpbGw9IiNEOEU5RkYiLz48cGF0aCBkPSJNMTI4IDEyOEMxMjggMTA5LjMyMiAxMTIuNDIyIDk0IDk0IDk0SDM0QzE1LjU3OCA5NCAwIDEwOS4zMjIgMCAxMjgiIGZpbGw9IiNEOEU5RkYiLz48L3N2Zz4='"
                                             class="w-full h-full object-cover bg-gradient-to-br from-gray-50 to-gray-100">
                                        <div class="absolute inset-0 bg-gradient-to-b from-transparent to-gray-900 opacity-0 group-hover:opacity-100 transition-all duration-300"></div>
                                        <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300">
                                            <span class="cursor-pointer bg-white/90 hover:bg-white text-gray-700 px-4 py-2 rounded-lg shadow-lg backdrop-blur-sm flex items-center gap-2 text-sm font-medium transition-all duration-300 transform group-hover:scale-105">
                                                <i class="fas fa-camera"></i>
                                                Change Photo
                                            </span>
                                        </div>
                                    </div>
                                    <p class="text-xs text-gray-500">Click or drag to upload (Max 5MB)</p>
                                </div>
                                <input type="file" id="profile_pic_upload" class="hidden" accept="image/*">
                            </div>
                        </div>
                        <div class="col-span-2 sm:col-span-1">
                             <label for="resume_upload" class="form-label flex items-center gap-2">
                                <i class="fas fa-file-pdf text-indigo-500"></i>
                                Resume (PDF)
                             </label>
                             <div class="file-upload-area" id="resume-area">
                                <div class="flex flex-col items-center gap-4">
                                    <div class="group relative w-32 h-32 rounded-2xl bg-gradient-to-br from-gray-50 to-gray-100 border-2 border-dashed border-gray-200 hover:border-indigo-300 transition-all duration-300 flex items-center justify-center">
                                        <div class="text-center">
                                            <i id="resume_icon" class="fa-solid fa-file-pdf text-4xl mb-2 text-gray-300 transition-colors duration-300"></i>
                                            <div class="text-xs font-medium text-gray-400">
                                                Upload Resume
                                            </div>
                                        </div>
                                        <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300">
                                            <span class="cursor-pointer bg-white/90 hover:bg-white text-gray-700 px-4 py-2 rounded-lg shadow-lg backdrop-blur-sm flex items-center gap-2 text-sm font-medium transition-all duration-300 transform group-hover:scale-105">
                                                <i class="fas fa-upload"></i>
                                                Upload PDF
                                            </span>
                                        </div>
                                    </div>
                                    <p class="text-xs text-gray-500">Click or drag to upload (Max 10MB)</p>
                                </div>
                                <input type="file" id="resume_upload" class="hidden" accept=".pdf">
                            </div>
                        </div>
                        <div class="col-span-2">
                            <label for="full_name" class="form-label flex items-center gap-2">
                                <i class="fas fa-badge text-indigo-500"></i>
                                Full Name
                            </label>
                            <div class="relative group">
                                <input type="text" id="full_name" 
                                       placeholder="Enter your full name" 
                                       value="" 
                                       class="form-input pl-10 focus:ring-2 focus:ring-indigo-500/20 group-hover:border-indigo-200">
                                <i class="fas fa-user absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 group-hover:text-indigo-400 transition-colors"></i>
                            </div>
                        </div>
                        <div class="col-span-2 sm:col-span-1">
                            <label for="company_name" class="form-label flex items-center gap-2">
                                <i class="fas fa-building text-indigo-500"></i>
                                Company Name
                            </label>
                            <div class="relative group">
                                <input type="text" id="company_name" 
                                       placeholder="Enter your company name" 
                                       value="" 
                                       class="form-input pl-10 focus:ring-2 focus:ring-indigo-500/20 group-hover:border-indigo-200">
                                <i class="fas fa-building absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 group-hover:text-indigo-400 transition-colors"></i>
                            </div>
                        </div>
                        <div class="col-span-2 sm:col-span-1">
                            <label for="job_title" class="form-label flex items-center gap-2">
                                <i class="fas fa-briefcase text-indigo-500"></i>
                                Job Title / Tagline
                            </label>
                            <div class="relative group">
                                <input type="text" id="job_title" 
                                       placeholder="Enter your job title" 
                                       value="" 
                                       class="form-input pl-10 focus:ring-2 focus:ring-indigo-500/20 group-hover:border-indigo-200">
                                <i class="fas fa-briefcase absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 group-hover:text-indigo-400 transition-colors"></i>
                            </div>
                        </div>
                        <div class="col-span-2">
                            <label for="bio" class="form-label flex items-center gap-2">
                                <i class="fas fa-pen-fancy text-indigo-500"></i>
                                Bio / About Me
                            </label>
                            <div class="relative group">
                                <textarea id="bio" rows="4" 
                                          placeholder="Write a brief introduction about yourself..." 
                                          class="form-input pl-10 focus:ring-2 focus:ring-indigo-500/20 group-hover:border-indigo-200"></textarea>
                                <i class="fas fa-quote-left absolute left-3 top-3 text-gray-400 group-hover:text-indigo-400 transition-colors"></i>
                            </div>
                            <p class="helper-text info mt-2">
                                <i class="fas fa-info-circle"></i>
                                This will be the main introduction on your portfolio
                            </p>
                        </div>
                    </div>
                </div>

                 <!-- Section: Skills -->
                <div id="skills" class="form-section relative">
                    <div class="absolute -top-2 -left-2 section-indicator">
                        2
                    </div>
                    <h2 class="form-section-title">
                        <i class="fas fa-code text-indigo-500"></i>
                        Skills & Expertise
                    </h2>
                    
                    <div class="mb-4">
                        <p class="text-sm text-gray-600">Add your skills to showcase your expertise. You can categorize them and indicate your proficiency level.</p>
                    </div>
                    
                    <!-- Skills Categories -->
                    <div class="skill-categories">
                        <div class="skill-category active" data-category="all">All Skills</div>
                        <div class="skill-category" data-category="technical">Technical</div>
                        <div class="skill-category" data-category="design">Design</div>
                        <div class="skill-category" data-category="soft">Soft Skills</div>
                        <div class="skill-category" data-category="language">Languages</div>
                    </div>
                    
                    <!-- Skills Container -->
                    <div id="skills-container" class="skills-container empty">
                        <!-- Skills will be dynamically added here -->
                    </div>
                    
                    <!-- Skills Stats -->
                    <div class="skills-stats">
                        <span id="skills-count">0 skills added</span>
                        <span id="skills-categories">All categories</span>
                    </div>
                    
                    <!-- Skill Input Area -->
                    <div class="skill-input-container">
                        <input type="text" id="skill-input" placeholder="Add a skill (e.g., JavaScript, UI/UX Design, Project Management)" class="skill-input">
                        <button type="button" id="add-skill-btn" class="add-skill-btn">
                            <i class="fas fa-plus"></i>
                            Add
                        </button>
                        
                        <!-- Skill Suggestions -->
                        <div id="skill-suggestions" class="skill-suggestions">
                            <!-- Suggestions will be dynamically added here -->
                        </div>
                    </div>
                    
                    <!-- Skill Level Selector (appears when editing a skill) -->
                    <div id="skill-level-selector" class="mt-4 hidden">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium text-gray-700">Proficiency Level</span>
                            <span id="skill-level-text" class="text-sm text-gray-600">Beginner</span>
                        </div>
                        <div class="skill-level">
                            <span class="skill-level-label">Beginner</span>
                            <div class="skill-level-bars">
                                <div class="skill-level-bar active" data-level="1"></div>
                                <div class="skill-level-bar" data-level="2"></div>
                                <div class="skill-level-bar" data-level="3"></div>
                                <div class="skill-level-bar" data-level="4"></div>
                                <div class="skill-level-bar" data-level="5"></div>
                            </div>
                            <span class="skill-level-label">Expert</span>
                        </div>
                        <div class="mt-3 flex justify-end">
                            <button id="save-skill-level" class="text-sm bg-indigo-600 text-white px-4 py-2 rounded-lg font-medium">Save Level</button>
                        </div>
                    </div>
                </div>

                <!-- Section: Contact & Social -->
                <div id="contact" class="form-section relative">
                    <div class="absolute -top-2 -left-2 section-indicator">
                        3
                    </div>
                    <h2 class="form-section-title">
                        <i class="fas fa-address-card text-indigo-500"></i>
                        Contact & Social Media
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="email" class="form-label">Email</label>
                            <div class="relative group">
                                <i class="fas fa-envelope absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                <input type="email" id="email" placeholder="Enter your email address" 
                                       value="" 
                                       class="form-input pl-10">
                            </div>
                        </div>
                        <div>
                            <label for="phone" class="form-label">Phone</label>
                            <div class="relative group">
                                <i class="fas fa-phone absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                <input type="text" id="phone" placeholder="Enter your phone number" 
                                       value="" 
                                       class="form-input pl-10">
                            </div>
                        </div>
                        <div class="url-input-wrapper">
                            <label for="linkedin_url" class="form-label">LinkedIn URL</label>
                            <div class="relative group">
                                <i class="fab fa-linkedin absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                <input type="url" id="linkedin_url" placeholder="Your LinkedIn profile URL" 
                                       value="" 
                                       class="form-input pl-10">
                            </div>
                        </div>
                        <div class="url-input-wrapper">
                            <label for="github_url" class="form-label">GitHub URL</label>
                            <div class="relative group">
                                <i class="fab fa-github absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                <input type="url" id="github_url" placeholder="Your GitHub profile URL" 
                                       value="" 
                                       class="form-input pl-10">
                            </div>
                        </div>
                        <div class="col-span-2 url-input-wrapper">
                            <label for="twitter_url" class="form-label">Twitter (X) URL</label>
                            <div class="relative group">
                                <i class="fab fa-twitter absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                <input type="url" id="twitter_url" placeholder="Your Twitter/X profile URL" 
                                       value="" 
                                       class="form-input pl-10">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section: Projects -->
                <div id="project1" class="form-section group/project hover-glow relative">
                    <div class="absolute -top-2 -left-2 section-indicator">
                        4
                    </div>
                    <div class="form-section-title flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-8 rounded-lg bg-indigo-50 flex items-center justify-center group-hover/project:bg-indigo-100 transition-colors">
                                <i class="fas fa-rocket text-indigo-500 group-hover/project:scale-110 transition-transform"></i>
                            </div>
                            <h2 class="flex items-center gap-2">Project 1</h2>
                        </div>
                        <span class="text-xs font-medium px-3 py-1 rounded-full bg-gray-50 text-gray-400">
                            In Development
                        </span>
                    </div>
                    <div class="space-y-6">
                        <div class="group">
                            <label for="project1_title" class="form-label flex items-center gap-2">
                                <i class="fas fa-heading text-indigo-500"></i>
                                Project Title
                            </label>
                            <div class="relative">
                                <input type="text" id="project1_title" 
                                       placeholder="What's your project called?" 
                                       value="" 
                                       class="form-input pl-10 group-hover:border-indigo-200 focus:ring-2 focus:ring-indigo-500/20">
                                <i class="fas fa-lightbulb absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 group-hover:text-indigo-400 transition-colors"></i>
                            </div>
                        </div>

                        <div class="group">
                            <label for="project1_link" class="form-label flex items-center gap-2">
                                <i class="fas fa-link text-indigo-500"></i>
                                Project URL
                                <span class="text-xs text-gray-500">(Optional)</span>
                            </label>
                            <div class="relative">
                                <input type="url" id="project1_link" 
                                       placeholder="https://your-project-url.com" 
                                       value="" 
                                       class="form-input pl-10 group-hover:border-indigo-200 focus:ring-2 focus:ring-indigo-500/20">
                                <i class="fas fa-globe absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 group-hover:text-indigo-400 transition-colors"></i>
                            </div>
                            <p class="helper-text info mt-2">
                                <i class="fas fa-info-circle"></i>
                                Add your live project URL or GitHub repository link
                            </p>
                        </div>

                        <div class="group">
                            <label for="project1_desc" class="form-label flex items-center gap-2">
                                <i class="fas fa-align-left text-indigo-500"></i>
                                Project Description
                            </label>
                            <div class="relative">
                                <textarea id="project1_desc" 
                                          rows="4" 
                                          placeholder="• What does your project do?
• What technologies did you use?
• What challenges did you overcome?
• What was your role in the project?" 
                                          class="form-input pl-10 group-hover:border-indigo-200 focus:ring-2 focus:ring-indigo-500/20"></textarea>
                                <i class="fas fa-edit absolute left-3 top-3 text-gray-400 group-hover:text-indigo-400 transition-colors"></i>
                            </div>
                            <div class="mt-2 flex items-center justify-between">
                                <p class="helper-text info">
                                    <i class="fas fa-info-circle"></i>
                                    Be concise but highlight key achievements
                                </p>
                                <p class="counter" id="desc_1_counter">
                                    <span class="font-medium">0</span> / 500 characters
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="project2" class="form-section group/project hover-glow relative">
                    <div class="absolute -top-2 -left-2 section-indicator">
                        5
                    </div>
                    <div class="form-section-title flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-8 rounded-lg bg-indigo-50 flex items-center justify-center group-hover/project:bg-indigo-100 transition-colors">
                                <i class="fas fa-rocket text-indigo-500 group-hover/project:scale-110 transition-transform"></i>
                            </div>
                            <h2 class="flex items-center gap-2">Project 2</h2>
                        </div>
                        <span class="text-xs font-medium px-3 py-1 rounded-full bg-gray-50 text-gray-400">
                            In Development
                        </span>
                    </div>
                    <div class="space-y-6">
                        <div class="group">
                            <label for="project2_title" class="form-label flex items-center gap-2">
                                <i class="fas fa-heading text-indigo-500"></i>
                                Project Title
                            </label>
                            <div class="relative">
                                <input type="text" id="project2_title" 
                                       placeholder="What's your project called?" 
                                       value="" 
                                       class="form-input pl-10 group-hover:border-indigo-200 focus:ring-2 focus:ring-indigo-500/20">
                                <i class="fas fa-lightbulb absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 group-hover:text-indigo-400 transition-colors"></i>
                            </div>
                        </div>

                        <div class="group">
                            <label for="project2_link" class="form-label flex items-center gap-2">
                                <i class="fas fa-link text-indigo-500"></i>
                                Project URL
                                <span class="text-xs text-gray-500">(Optional)</span>
                            </label>
                            <div class="relative">
                                <input type="url" id="project2_link" 
                                       placeholder="https://your-project-url.com" 
                                       value="" 
                                       class="form-input pl-10 group-hover:border-indigo-200 focus:ring-2 focus:ring-indigo-500/20">
                                <i class="fas fa-globe absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 group-hover:text-indigo-400 transition-colors"></i>
                            </div>
                            <p class="helper-text info mt-2">
                                <i class="fas fa-info-circle"></i>
                                Add your live project URL or GitHub repository link
                            </p>
                        </div>

                        <div class="group">
                            <label for="project2_desc" class="form-label flex items-center gap-2">
                                <i class="fas fa-align-left text-indigo-500"></i>
                                Project Description
                            </label>
                            <div class="relative">
                                <textarea id="project2_desc" 
                                          rows="4" 
                                          placeholder="• What does your project do?
• What technologies did you use?
• What challenges did you overcome?
• What was your role in the project?" 
                                          class="form-input pl-10 group-hover:border-indigo-200 focus:ring-2 focus:ring-indigo-500/20"></textarea>
                                <i class="fas fa-edit absolute left-3 top-3 text-gray-400 group-hover:text-indigo-400 transition-colors"></i>
                            </div>
                            <div class="mt-2 flex items-center justify-between">
                                <p class="helper-text info">
                                    <i class="fas fa-info-circle"></i>
                                    Be concise but highlight key achievements
                                </p>
                                <p class="counter" id="desc_2_counter">
                                    <span class="font-medium">0</span> / 500 characters
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="project3" class="form-section group/project hover-glow relative">
                    <div class="absolute -top-2 -left-2 section-indicator">
                        6
                    </div>
                    <div class="form-section-title flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-8 rounded-lg bg-indigo-50 flex items-center justify-center group-hover/project:bg-indigo-100 transition-colors">
                                <i class="fas fa-rocket text-indigo-500 group-hover/project:scale-110 transition-transform"></i>
                            </div>
                            <h2 class="flex items-center gap-2">Project 3</h2>
                        </div>
                        <span class="text-xs font-medium px-3 py-1 rounded-full bg-gray-50 text-gray-400">
                            In Development
                        </span>
                    </div>
                    <div class="space-y-6">
                        <div class="group">
                            <label for="project3_title" class="form-label flex items-center gap-2">
                                <i class="fas fa-heading text-indigo-500"></i>
                                Project Title
                            </label>
                            <div class="relative">
                                <input type="text" id="project3_title" 
                                       placeholder="What's your project called?" 
                                       value="" 
                                       class="form-input pl-10 group-hover:border-indigo-200 focus:ring-2 focus:ring-indigo-500/20">
                                <i class="fas fa-lightbulb absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 group-hover:text-indigo-400 transition-colors"></i>
                            </div>
                        </div>

                        <div class="group">
                            <label for="project3_link" class="form-label flex items-center gap-2">
                                <i class="fas fa-link text-indigo-500"></i>
                                Project URL
                                <span class="text-xs text-gray-500">(Optional)</span>
                            </label>
                            <div class="relative">
                                <input type="url" id="project3_link" 
                                       placeholder="https://your-project-url.com" 
                                       value="" 
                                       class="form-input pl-10 group-hover:border-indigo-200 focus:ring-2 focus:ring-indigo-500/20">
                                <i class="fas fa-globe absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 group-hover:text-indigo-400 transition-colors"></i>
                            </div>
                            <p class="helper-text info mt-2">
                                <i class="fas fa-info-circle"></i>
                                Add your live project URL or GitHub repository link
                            </p>
                        </div>

                        <div class="group">
                            <label for="project3_desc" class="form-label flex items-center gap-2">
                                <i class="fas fa-align-left text-indigo-500"></i>
                                Project Description
                            </label>
                            <div class="relative">
                                <textarea id="project3_desc" 
                                          rows="4" 
                                          placeholder="• What does your project do?
• What technologies did you use?
• What challenges did you overcome?
• What was your role in the project?" 
                                          class="form-input pl-10 group-hover:border-indigo-200 focus:ring-2 focus:ring-indigo-500/20"></textarea>
                                <i class="fas fa-edit absolute left-3 top-3 text-gray-400 group-hover:text-indigo-400 transition-colors"></i>
                            </div>
                            <div class="mt-2 flex items-center justify-between">
                                <p class="helper-text info">
                                    <i class="fas fa-info-circle"></i>
                                    Be concise but highlight key achievements
                                </p>
                                <p class="counter" id="desc_3_counter">
                                    <span class="font-medium">0</span> / 500 characters
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="pt-4 sticky bottom-4 bg-white/80 backdrop-blur-sm p-4 rounded-xl border border-indigo-100 mt-8">
                    <button type="button" id="save-button" class="save-button w-full py-3 px-4 font-semibold rounded-lg focus:outline-none transition-all duration-300 flex items-center justify-center gap-2">
                        <i class="fa-solid fa-floppy-disk"></i>
                        <span>Save Portfolio</span>
                    </button>
                    <p id="save-status" class="status-message mt-2"></p>
                </div>
            </form>
        </aside>

        <!-- Preview -->
        <main class="w-2/3 bg-gray-200 p-8">
             <div class="preview-frame w-full h-full">
                <iframe id="preview-frame" src="about:blank" class="w-full h-full border-0"></iframe>
            </div>
        </main>
    </div>

    <script>
        // Debounce function
        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Global form data collection function
        function collectFormData() {
            const selectedTemplate = document.querySelector('.template-option.selected');
            const templateId = selectedTemplate ? selectedTemplate.getAttribute('data-template-id') : '1';
            
            console.log('Collecting form data, template ID:', templateId);
            
            const formData = {
                template_id: templateId,
                full_name: document.getElementById('full_name').value,
                company_name: document.getElementById('company_name').value,
                job_title: document.getElementById('job_title').value,
                bio: document.getElementById('bio').value,
                profile_pic: document.getElementById('profile_pic').value,
                resume_file: document.getElementById('resume_file').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                linkedin_url: document.getElementById('linkedin_url').value,
                github_url: document.getElementById('github_url').value,
                twitter_url: document.getElementById('twitter_url').value,
                skills: window.skills || [],
                project1_title: document.getElementById('project1_title').value,
                project1_link: document.getElementById('project1_link').value,
                project1_desc: document.getElementById('project1_desc').value,
                project2_title: document.getElementById('project2_title').value,
                project2_link: document.getElementById('project2_link').value,
                project2_desc: document.getElementById('project2_desc').value,
                project3_title: document.getElementById('project3_title').value,
                project3_link: document.getElementById('project3_link').value,
                project3_desc: document.getElementById('project3_desc').value
            };
            
            console.log('Form data collected:', formData);
            return formData;
        }

        // Global preview function accessible to template selection
        const updatePreview = debounce(function() {
            const formData = collectFormData();
            
            // Show loading state
            const previewFrame = document.getElementById('preview-frame');
            if (!previewFrame) {
                console.error('Preview frame not found');
                return;
            }
            
            previewFrame.style.opacity = '0.7';
            
            fetch('/preview', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.text();
            })
            .then(html => {
                // Create a blob URL for the preview
                const blob = new Blob([html], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                previewFrame.src = url;
                previewFrame.style.opacity = '1';
                
                // Clean up old blob URLs to prevent memory leaks
                previewFrame.addEventListener('load', function() {
                    if (previewFrame.dataset.oldUrl) {
                        URL.revokeObjectURL(previewFrame.dataset.oldUrl);
                    }
                    previewFrame.dataset.oldUrl = url;
                });
            })
            .catch(error => {
                console.error('Error loading preview:', error);
                previewFrame.style.opacity = '1';
                previewFrame.srcdoc = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Preview Error</title>
                        <style>
                            body { 
                                font-family: Arial, sans-serif; 
                                display: flex; 
                                align-items: center; 
                                justify-content: center; 
                                height: 100vh; 
                                margin: 0; 
                                background: #f5f5f5; 
                                color: #666;
                            }
                            .error-container { 
                                text-align: center; 
                                padding: 2rem;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="error-container">
                            <h2>Preview Unavailable</h2>
                            <p>There was an error loading the preview.</p>
                        </div>
                    </body>
                    </html>
                `;
                previewFrame.style.opacity = '1';
            });
        }, 500);

        // Global initialization function for preview functionality
        function initializePreview() {
            const form = document.querySelector('.dashboard-container');
            if (!form) {
                console.error('Dashboard form not found');
                return;
            }
            
            // Listen for form changes
            const formElements = form.querySelectorAll('input, textarea, select');
            formElements.forEach(element => {
                element.addEventListener('input', updatePreview);
                element.addEventListener('change', updatePreview);
            });
            
            // Also update when skills change
            const skillsContainer = document.getElementById('skills-container');
            if (skillsContainer) {
                const skillsObserver = new MutationObserver(updatePreview);
                skillsObserver.observe(skillsContainer, {
                    childList: true,
                    subtree: true
                });
            }
            
            // Initial preview with delay to ensure DOM is ready
            setTimeout(updatePreview, 1000);
        }

        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize templates
            initializeTemplates();
            
            // Initialize skills functionality
            initializeSkills();
            
            // Initialize file uploads
            initializeFileUploads();
            
            // Initialize character counters
            initializeCharacterCounters();
            
            // Initialize scroll indicator
            initializeScrollIndicator();
            
            // Initialize save functionality
            initializeSaveButton();

             // Initialize preview
            initializePreview();
                    
            // Copy to clipboard function
            window.copyToClipboard = function(text) {
                navigator.clipboard.writeText(text).then(function() {
                    // Show success message
                    const button = event.target.closest('button');
                    const originalIcon = button.innerHTML;
                    button.innerHTML = '<i class="fas fa-check"></i>';
                    button.classList.add('text-green-500');
                    
                    setTimeout(() => {
                        button.innerHTML = originalIcon;
                        button.classList.remove('text-green-500');
                    }, 2000);
                }, function(err) {
                    console.error('Could not copy text: ', err);
                });
            };
        });

        function initializeTemplates() {
            const templateContainer = document.getElementById('template-selector');
            
            for (let i = 1; i <= 10; i++) {
                const templateOption = document.createElement('div');
                templateOption.className = `template-option cursor-pointer template-preview ${i === 1 ? 'selected' : ''}`;
                templateOption.setAttribute('data-template-id', i);
                
                templateOption.innerHTML = `
                    <img src="https://placehold.co/400x300/e2e8f0/4a5568?text=Template+${i}" alt="Template ${i}" class="w-full h-auto object-cover block">
                    <div class="text-xs text-center py-2 bg-gray-50 text-gray-700 font-medium">Template ${i}</div>
                `;
                
                templateOption.addEventListener('click', function() {
                    console.log('Template clicked:', i);
                    document.querySelectorAll('.template-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    console.log('Template selected:', this.getAttribute('data-template-id'));
                    
                    // Update template input value
                    const templateInput = document.getElementById('template');
                    if (templateInput) {
                        templateInput.value = i;
                    }
                    
                    // Call preview update if available
                    if (typeof updatePreview === 'function') {
                        updatePreview();
                    } else {
                        console.log('updatePreview function not yet available');
                    }
                });
                
                templateContainer.appendChild(templateOption);
            }
        }

        function initializeSkills() {
            // Sample skill suggestions
            const skillSuggestions = {
                technical: [
                    'JavaScript', 'Python', 'React', 'Node.js', 'HTML/CSS',
                    'SQL', 'Git', 'AWS', 'Docker', 'Machine Learning'
                ],
                design: [
                    'UI/UX Design', 'Figma', 'Adobe Creative Suite', 'Wireframing',
                    'Prototyping', 'User Research', 'Visual Design'
                ],
                soft: [
                    'Project Management', 'Communication', 'Leadership',
                    'Problem Solving', 'Team Collaboration', 'Time Management'
                ],
                language: [
                    'English', 'Spanish', 'French', 'German', 'Japanese',
                    'Chinese', 'Arabic'
                ]
            };
            
            // Current skills data
            window.skills = [];
            let currentCategory = 'all';
            let editingSkillId = null;
            
            // DOM elements
            const skillsContainer = document.getElementById('skills-container');
            const skillInput = document.getElementById('skill-input');
            const addSkillBtn = document.getElementById('add-skill-btn');
            const skillSuggestionsEl = document.getElementById('skill-suggestions');
            const skillCategories = document.querySelectorAll('.skill-category');
            const skillsCount = document.getElementById('skills-count');
            const skillsCategoriesEl = document.getElementById('skills-categories');
            const skillLevelSelector = document.getElementById('skill-level-selector');
            const skillLevelBars = document.querySelectorAll('.skill-level-bar');
            const skillLevelText = document.getElementById('skill-level-text');
            const saveSkillLevelBtn = document.getElementById('save-skill-level');
            
            // Initialize with some sample skills
            initializeSampleSkills();
            
            // Event listeners
            addSkillBtn.addEventListener('click', addSkill);
            skillInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addSkill();
                }
            });
            
            skillInput.addEventListener('input', function() {
                showSuggestions(this.value);
            });
            
            skillInput.addEventListener('focus', function() {
                if (this.value) {
                    showSuggestions(this.value);
                }
            });
            
            // Category selection
            skillCategories.forEach(category => {
                category.addEventListener('click', function() {
                    skillCategories.forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    currentCategory = this.getAttribute('data-category');
                    filterSkillsByCategory();
                });
            });
            
            // Skill level selection
            skillLevelBars.forEach(bar => {
                bar.addEventListener('click', function() {
                    const level = parseInt(this.getAttribute('data-level'));
                    setSkillLevel(level);
                });
            });
            
            saveSkillLevelBtn.addEventListener('click', saveSkillLevel);
            
            // Functions
            function initializeSampleSkills() {
                // Add a few sample skills
                addSkillToData('JavaScript', 'technical', 4);
                addSkillToData('React', 'technical', 3);
                addSkillToData('UI/UX Design', 'design', 4);
                addSkillToData('Project Management', 'soft', 5);
                renderSkills();
            }
            
            function addSkill() {
                const skillName = skillInput.value.trim();
                
                if (!skillName) {
                    shakeInput();
                    return;
                }
                
                if (window.skills.find(s => s.name.toLowerCase() === skillName.toLowerCase())) {
                    showMessage('Skill already exists!', 'error');
                    shakeInput();
                    return;
                }
                
                addSkillToData(skillName, currentCategory === 'all' ? 'technical' : currentCategory, 3);
                skillInput.value = '';
                hideSuggestions();
                renderSkills();
                showMessage('Skill added successfully!', 'success');
            }
            
            function addSkillToData(name, category, level) {
                const skill = {
                    id: Date.now().toString(),
                    name: name,
                    category: category,
                    level: level
                };
                
                window.skills.push(skill);
            }
            
            function renderSkills() {
                skillsContainer.innerHTML = '';
                
                const filteredSkills = currentCategory === 'all' 
                    ? window.skills 
                    : window.skills.filter(skill => skill.category === currentCategory);
                
                if (filteredSkills.length === 0) {
                    skillsContainer.classList.add('empty');
                    skillsContainer.innerHTML = '';
                } else {
                    skillsContainer.classList.remove('empty');
                    
                    filteredSkills.forEach(skill => {
                        const skillEl = document.createElement('div');
                        skillEl.className = 'skill-tag';
                        skillEl.setAttribute('data-id', skill.id);
                        
                        // Add category color indicator
                        const categoryColor = getCategoryColor(skill.category);
                        skillEl.style.background = categoryColor;
                        
                        skillEl.innerHTML = `
                            <span class="skill-name">${skill.name}</span>
                            <div class="remove-skill" title="Remove skill">
                                <i class="fas fa-times"></i>
                            </div>
                        `;
                        
                        // Add level indicator as small bars
                        const levelIndicator = document.createElement('div');
                        levelIndicator.className = 'skill-level-bars skill-level-bars-small';
                        levelIndicator.style.marginLeft = '8px';
                        levelIndicator.style.display = 'flex';
                        levelIndicator.style.gap = '2px';
                        
                        for (let i = 1; i <= 5; i++) {
                            const bar = document.createElement('div');
                            bar.className = `skill-level-bar ${i <= skill.level ? 'active' : ''}`;
                            bar.style.width = '4px';
                            bar.style.height = '4px';
                            bar.style.borderRadius = '1px';
                            bar.style.background = i <= skill.level ? 'rgba(255,255,255,0.9)' : 'rgba(255,255,255,0.3)';
                            levelIndicator.appendChild(bar);
                        }
                        
                        skillEl.querySelector('.skill-name').after(levelIndicator);
                        
                        // Add click event to edit skill level
                        levelIndicator.addEventListener('click', function(e) {
                            e.stopPropagation();
                            editSkillLevel(skill.id);
                        });
                        
                        // Add remove functionality
                        const removeBtn = skillEl.querySelector('.remove-skill');
                        removeBtn.addEventListener('click', function(e) {
                            e.stopPropagation();
                            removeSkill(skill.id);
                        });
                        
                        skillsContainer.appendChild(skillEl);
                    });
                }
                
                updateStats();
            }
            
            function editSkillLevel(skillId) {
                const skill = window.skills.find(s => s.id === skillId);
                if (!skill) return;
                
                editingSkillId = skillId;
                setSkillLevel(skill.level);
                skillLevelSelector.classList.remove('hidden');
                
                // Scroll to level selector
                skillLevelSelector.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
            
            function setSkillLevel(level) {
                skillLevelBars.forEach(bar => {
                    const barLevel = parseInt(bar.getAttribute('data-level'));
                    bar.classList.toggle('active', barLevel <= level);
                });
                
                // Update level text
                const levelTexts = ['Beginner', 'Intermediate', 'Advanced', 'Expert', 'Master'];
                skillLevelText.textContent = levelTexts[level - 1] || 'Beginner';
            }
            
            function saveSkillLevel() {
                if (!editingSkillId) return;
                
                const activeLevel = document.querySelectorAll('.skill-level-bar.active').length;
                const skillIndex = window.skills.findIndex(s => s.id === editingSkillId);
                
                if (skillIndex !== -1) {
                    window.skills[skillIndex].level = activeLevel;
                    renderSkills();
                    skillLevelSelector.classList.add('hidden');
                    editingSkillId = null;
                    showMessage('Skill level updated!', 'success');
                }
            }
            
            function removeSkill(skillId) {
                window.skills = window.skills.filter(skill => skill.id !== skillId);
                renderSkills();
                showMessage('Skill removed!', 'success');
            }
            
            function filterSkillsByCategory() {
                renderSkills();
                skillsCategoriesEl.textContent = currentCategory === 'all' ? 'All categories' : `${currentCategory} skills`;
            }
            
            function showSuggestions(query) {
                if (!query) {
                    hideSuggestions();
                    return;
                }
                
                const suggestions = [];
                Object.keys(skillSuggestions).forEach(category => {
                    skillSuggestions[category].forEach(skill => {
                        if (skill.toLowerCase().includes(query.toLowerCase()) && 
                            !window.skills.find(s => s.name.toLowerCase() === skill.toLowerCase())) {
                            suggestions.push({ skill, category });
                        }
                    });
                });
                
                if (suggestions.length > 0) {
                    skillSuggestionsEl.innerHTML = '';
                    suggestions.slice(0, 5).forEach(({ skill, category }) => {
                        const suggestionEl = document.createElement('div');
                        suggestionEl.className = 'skill-suggestion';
                        suggestionEl.innerHTML = `
                            <i class="fas fa-${getCategoryIcon(category)}"></i>
                            <span>${skill}</span>
                            <span class="ml-auto text-xs text-gray-500">${category}</span>
                        `;
                        
                        suggestionEl.addEventListener('click', function() {
                            skillInput.value = skill;
                            addSkill();
                        });
                        
                        skillSuggestionsEl.appendChild(suggestionEl);
                    });
                    
                    skillSuggestionsEl.style.display = 'block';
                } else {
                    hideSuggestions();
                }
            }
            
            function hideSuggestions() {
                skillSuggestionsEl.style.display = 'none';
            }
            
            function getCategoryColor(category) {
                const colors = {
                    technical: 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',
                    design: 'linear-gradient(135deg, #06b6d4 0%, #10b981 100%)',
                    soft: 'linear-gradient(135deg, #f59e0b 0%, #ef4444 100%)',
                    language: 'linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%)'
                };
                
                return colors[category] || colors.technical;
            }
            
            function getCategoryIcon(category) {
                const icons = {
                    technical: 'code',
                    design: 'palette',
                    soft: 'users',
                    language: 'language'
                };
                
                return icons[category] || 'star';
            }
            
            function updateStats() {
                const filteredSkills = currentCategory === 'all' 
                    ? window.skills 
                    : window.skills.filter(skill => skill.category === currentCategory);
                
                skillsCount.textContent = `${filteredSkills.length} skill${filteredSkills.length !== 1 ? 's' : ''} added`;
            }
            
            function showMessage(message, type) {
                // Create a temporary message element
                const messageEl = document.createElement('div');
                messageEl.className = `fixed top-4 right-4 px-4 py-2 rounded-lg text-white font-medium z-50 ${
                    type === 'success' ? 'bg-green-500' : 'bg-red-500'
                }`;
                messageEl.textContent = message;
                
                document.body.appendChild(messageEl);
                
                // Remove after 3 seconds
                setTimeout(() => {
                    messageEl.remove();
                }, 3000);
            }
            
            function shakeInput() {
                skillInput.classList.add('shake');
                setTimeout(() => {
                    skillInput.classList.remove('shake');
                }, 500);
            }
        }

        function initializeFileUploads() {
            const fileUploadAreas = document.querySelectorAll('.file-upload-area');
            
            fileUploadAreas.forEach(area => {
                area.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('dragover');
                });
                
                area.addEventListener('dragleave', function() {
                    this.classList.remove('dragover');
                });
                
                area.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        const fileInput = this.querySelector('input[type="file"]');
                        fileInput.files = files;
                        handleFileUpload(fileInput);
                    }
                });
                
                // Handle click to upload
                area.addEventListener('click', function(e) {
                    if (e.target.tagName !== 'INPUT') {
                        const fileInput = this.querySelector('input[type="file"]');
                        fileInput.click();
                    }
                });
                
                // Handle file input change
                const fileInput = area.querySelector('input[type="file"]');
                fileInput.addEventListener('change', function() {
                    handleFileUpload(this);
                });
            });
            
            function handleFileUpload(fileInput) {
                if (fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    const fileType = file.type;
                    const fileSize = file.size;
                    
                    // Validate file size
                    const maxSize = fileInput.id === 'profile_pic_upload' ? 5 * 1024 * 1024 : 10 * 1024 * 1024;
                    if (fileSize > maxSize) {
                        showMessage(`File size exceeds ${maxSize/(1024*1024)}MB limit`, 'error');
                        return;
                    }
                    
                    // Handle image preview for profile picture
                    if (fileInput.id === 'profile_pic_upload') {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            document.getElementById('profile_pic_preview').src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                    
                    // Handle resume upload
                    if (fileInput.id === 'resume_upload') {
                        document.getElementById('resume_icon').classList.remove('text-gray-300');
                        document.getElementById('resume_icon').classList.add('text-green-500');
                        document.querySelector('#resume-area .text-xs').textContent = 'Resume Uploaded';
                        document.querySelector('#resume-area .text-xs').classList.remove('text-gray-400');
                        document.querySelector('#resume-area .text-xs').classList.add('text-green-600');
                    }
                    
                    // Upload file to server
                    uploadFileToServer(file, fileInput.id);
                }
            }
            
            function uploadFileToServer(file, inputId) {
                const formData = new FormData();
                formData.append('file', file);
                
                showMessage('Uploading file...', 'info');
                
                fetch('/upload', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Update hidden input with file path
                        if (inputId === 'profile_pic_upload') {
                            document.getElementById('profile_pic').value = data.filepath;
                        } else if (inputId === 'resume_upload') {
                            document.getElementById('resume_file').value = data.filepath;
                        }
                        showMessage('File uploaded successfully!', 'success');
                        updatePreview(); // Update preview after successful upload
                    } else {
                        showMessage(`Upload failed: ${data.message}`, 'error');
                    }
                })
                .catch(error => {
                    console.error('Upload error:', error);
                    showMessage('Upload failed. Please try again.', 'error');
                });
            }
        }

        function initializeCharacterCounters() {
            for (let i = 1; i <= 3; i++) {
                const textarea = document.getElementById(`project${i}_desc`);
                const counter = document.getElementById(`desc_${i}_counter`);
                
                if (textarea && counter) {
                    // Set initial count
                    const count = textarea.value.length;
                    counter.querySelector('span').textContent = count;
                    updateCounterStyle(counter, count);
                    
                    textarea.addEventListener('input', function() {
                        const count = this.value.length;
                        counter.querySelector('span').textContent = count;
                        updateCounterStyle(counter, count);
                    });
                }
            }
            
            function updateCounterStyle(counter, count) {
                counter.className = 'counter';
                if (count > 450) {
                    counter.classList.add('warning');
                }
                if (count > 500) {
                    counter.classList.add('error');
                }
            }
        }

        function initializeScrollIndicator() {
            const scrollDots = document.querySelectorAll('.scroll-dot');
            const sections = document.querySelectorAll('.form-section, #public-url, #template');
            
            // Function to update active dot based on scroll position
            function updateActiveDot() {
                const scrollTop = document.querySelector('.sidebar').scrollTop;
                
                sections.forEach((section, index) => {
                    const sectionTop = section.offsetTop - 100;
                    const sectionBottom = sectionTop + section.offsetHeight;
                    
                    if (scrollTop >= sectionTop && scrollTop < sectionBottom) {
                        scrollDots.forEach(dot => dot.classList.remove('active'));
                        scrollDots[index].classList.add('active');
                    }
                });
            }
            
            // Add scroll event listener to sidebar
            document.querySelector('.sidebar').addEventListener('scroll', updateActiveDot);
            
            // Add click event to scroll dots
            scrollDots.forEach(dot => {
                dot.addEventListener('click', function() {
                    const sectionId = this.getAttribute('data-section');
                    const section = document.getElementById(sectionId);
                    if (section) {
                        document.querySelector('.sidebar').scrollTo({
                            top: section.offsetTop - 20,
                            behavior: 'smooth'
                        });
                    }
                });
            });
        }

        function initializeSaveButton() {
            const saveButton = document.getElementById('save-button');
            const saveStatus = document.getElementById('save-status');
            
            saveButton.addEventListener('click', function() {
                // Collect all form data
                const formData = collectFormData();
                
                // Show saving state
                saveButton.classList.add('saving');
                saveButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Saving...</span>';
                saveStatus.textContent = '';
                saveStatus.className = 'status-message';
                
                // Send data to server (mock endpoint for demonstration)
                // In a real application, this would point to your backend
                fetch('https://jsonplaceholder.typicode.com/posts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    // Success
                    saveButton.classList.remove('saving');
                    saveButton.classList.add('success');
                    saveButton.innerHTML = '<i class="fas fa-check"></i><span>Saved Successfully!</span>';
                    saveStatus.textContent = 'Your portfolio has been updated.';
                    saveStatus.classList.add('success');
                    
                    setTimeout(() => {
                        saveButton.classList.remove('success');
                        saveButton.innerHTML = '<i class="fa-solid fa-floppy-disk"></i><span>Save Portfolio</span>';
                        saveStatus.textContent = '';
                        saveStatus.classList.remove('success');
                    }, 3000);
                })
                .catch(error => {
                    // Error handling
                    console.error('Error:', error);
                    saveButton.classList.remove('saving');
                    saveButton.classList.add('error');
                    saveButton.innerHTML = '<i class="fas fa-exclamation-triangle"></i><span>Error Saving</span>';
                    saveStatus.textContent = 'There was an error saving your portfolio. Please try again.';
                    saveStatus.classList.add('error');
                    
                    setTimeout(() => {
                        saveButton.classList.remove('error');
                        saveButton.innerHTML = '<i class="fa-solid fa-floppy-disk"></i><span>Save Portfolio</span>';
                        saveStatus.textContent = '';
                        saveStatus.classList.remove('error');
                    }, 3000);
                });
            });
            
        // Global helper functions
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Global preview function accessible to template selection
        updatePreview = debounce(function() {
            const formData = collectFormData();
            
            // Show loading state
            const previewFrame = document.getElementById('preview-frame');
            if (!previewFrame) {
                console.error('Preview frame not found');
                return;
            }
            
            previewFrame.style.opacity = '0.7';
            
            fetch('/preview', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.text();
            })
            .then(html => {
                // Create a blob URL for the preview
                const blob = new Blob([html], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                previewFrame.src = url;
                previewFrame.style.opacity = '1';
                
                // Clean up old blob URLs to prevent memory leaks
                previewFrame.addEventListener('load', function() {
                    if (previewFrame.dataset.oldUrl) {
                        URL.revokeObjectURL(previewFrame.dataset.oldUrl);
                    }
                    previewFrame.dataset.oldUrl = url;
                });
            })
            .catch(error => {
                console.error('Error loading preview:', error);
                previewFrame.style.opacity = '1';
                previewFrame.srcdoc = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Preview Error</title>
                        <style>
                            body { 
                                font-family: Arial, sans-serif; 
                                display: flex; 
                                align-items: center; 
                                justify-content: center; 
                                height: 100vh; 
                                margin: 0; 
                                background: #f5f5f5; 
                                color: #666;
                            }
                            .error-container { 
                                text-align: center; 
                                padding: 2rem;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="error-container">
                            <h2>Preview Unavailable</h2>
                            <p>There was an error loading the preview.</p>
                        </div>
                    </body>
                    </html>
                `;
                previewFrame.style.opacity = '1';
            });
        }, 500);

        // Global initialization function for preview functionality
        initializePreview = function() {
            const form = document.querySelector('.dashboard-container');
            if (!form) {
                console.error('Dashboard form not found');
                return;
            }
            
            // Listen for form changes
            const formElements = form.querySelectorAll('input, textarea, select');
            formElements.forEach(element => {
                element.addEventListener('input', updatePreview);
                element.addEventListener('change', updatePreview);
            });
            
            // Also update when skills change
            const skillsContainer = document.getElementById('skills-container');
            if (skillsContainer) {
                const skillsObserver = new MutationObserver(updatePreview);
                skillsObserver.observe(skillsContainer, {
                    childList: true,
                    subtree: true
                });
            }
            
            // Initial preview with delay to ensure DOM is ready
            setTimeout(updatePreview, 1000);
        };

        // Global form data collection function
        function collectFormData() {
            const selectedTemplate = document.querySelector('.template-option.selected');
            const templateId = selectedTemplate ? selectedTemplate.getAttribute('data-template-id') : '1';
            
            console.log('Collecting form data, template ID:', templateId);
            
            const formData = {
                template_id: templateId,
                full_name: document.getElementById('full_name').value,
                company_name: document.getElementById('company_name').value,
                job_title: document.getElementById('job_title').value,
                bio: document.getElementById('bio').value,
                profile_pic: document.getElementById('profile_pic').value,
                resume_file: document.getElementById('resume_file').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                linkedin_url: document.getElementById('linkedin_url').value,
                github_url: document.getElementById('github_url').value,
                twitter_url: document.getElementById('twitter_url').value,
                skills: window.skills || [],
                project1_title: document.getElementById('project1_title').value,
                project1_link: document.getElementById('project1_link').value,
                project1_desc: document.getElementById('project1_desc').value,
                project2_title: document.getElementById('project2_title').value,
                project2_link: document.getElementById('project2_link').value,
                project2_desc: document.getElementById('project2_desc').value,
                project3_title: document.getElementById('project3_title').value,
                project3_link: document.getElementById('project3_link').value,
                project3_desc: document.getElementById('project3_desc').value
            };
            
            console.log('Form data collected:', formData);
            return formData;
        }

        function initializeSaveButton() {
            const saveButton = document.getElementById('save-button');
            const saveStatus = document.getElementById('save-status');
            
            saveButton.addEventListener('click', function() {
                // Collect all form data
                const formData = collectFormData();
                
                // Show saving state
                saveButton.classList.add('saving');
                saveButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Saving...</span>';
                saveStatus.textContent = '';
                saveStatus.className = 'status-message';
                
                // Send data to server (mock endpoint for demonstration)
                // In a real application, this would point to your backend
                fetch('https://jsonplaceholder.typicode.com/posts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
            
            saveButton.addEventListener('click', function() {
                const formData = collectFormData();
                
                // Show saving state
                saveButton.classList.add('saving');
                saveButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Saving...</span>';
                saveStatus.textContent = '';
                saveStatus.className = 'status-message';
                
                // Send to your Flask backend
                fetch('/save_portfolio', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        saveButton.classList.remove('saving');
                        saveButton.classList.add('success');
                        saveButton.innerHTML = '<i class="fas fa-check"></i><span>Saved Successfully!</span>';
                        saveStatus.textContent = data.message || 'Your portfolio has been updated.';
                        saveStatus.classList.add('success');
                        
                        setTimeout(() => {
                            saveButton.classList.remove('success');
                            saveButton.innerHTML = '<i class="fa-solid fa-floppy-disk"></i><span>Save Portfolio</span>';
                            saveStatus.textContent = '';
                            saveStatus.classList.remove('success');
                        }, 3000);
                    } else {
                        throw new Error(data.message || 'Failed to save portfolio');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    saveButton.classList.remove('saving');
                    saveButton.classList.add('error');
                    saveButton.innerHTML = '<i class="fas fa-exclamation-triangle"></i><span>Error Saving</span>';
                    saveStatus.textContent = error.message || 'There was an error saving your portfolio. Please try again.';
                    saveStatus.classList.add('error');
                    
                    setTimeout(() => {
                        saveButton.classList.remove('error');
                        saveButton.innerHTML = '<i class="fa-solid fa-floppy-disk"></i><span>Save Portfolio</span>';
                        saveStatus.textContent = '';
                        saveStatus.classList.remove('error');
                    }, 3000);
                });
            });
        }

        // Update the file upload to use your Flask endpoint
        function initializeFileUploads() {
            const fileUploadAreas = document.querySelectorAll('.file-upload-area');
            
            fileUploadAreas.forEach(area => {
                // ... (keep existing drag/drop code) ...
                
                // Handle file input change
                const fileInput = area.querySelector('input[type="file"]');
                fileInput.addEventListener('change', function() {
                    handleFileUpload(this);
                });
            });
            
            function handleFileUpload(fileInput) {
                if (fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    const fileType = file.type;
                    const fileSize = file.size;
                    
                    // Validate file size
                    const maxSize = fileInput.id === 'profile_pic_upload' ? 5 * 1024 * 1024 : 10 * 1024 * 1024;
                    if (fileSize > maxSize) {
                        showMessage(`File size exceeds ${maxSize/(1024*1024)}MB limit`, 'error');
                        return;
                    }
                    
                    // Create FormData for file upload
                    const formData = new FormData();
                    formData.append('file', file);
                    
                    // Upload to Flask backend
                    fetch('/upload', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Handle image preview for profile picture
                            if (fileInput.id === 'profile_pic_upload') {
                                const reader = new FileReader();
                                reader.onload = function(e) {
                                    document.getElementById('profile_pic_preview').src = e.target.result;
                                };
                                reader.readAsDataURL(file);
                                document.getElementById('profile_pic').value = data.filepath;
                            }
                            
                            // Handle resume upload
                            if (fileInput.id === 'resume_upload') {
                                document.getElementById('resume_icon').classList.remove('text-gray-300');
                                document.getElementById('resume_icon').classList.add('text-green-500');
                                document.querySelector('#resume-area .text-xs').textContent = 'Resume Uploaded';
                                document.querySelector('#resume-area .text-xs').classList.remove('text-gray-400');
                                document.querySelector('#resume-area .text-xs').classList.add('text-green-600');
                                document.getElementById('resume_file').value = data.filepath;
                            }
                            
                            showMessage('File uploaded successfully!', 'success');
                            
                            // Update preview after file upload
                            setTimeout(updatePreview, 500);
                        } else {
                            throw new Error(data.message || 'Upload failed');
                        }
                    })
                    .catch(error => {
                        console.error('Upload error:', error);
                        showMessage(`Upload failed: ${error.message}`, 'error');
                    });
                }
            }
        }
    
        function showMessage(message, type) {
        // Create a temporary message element
        const messageEl = document.createElement('div');
        messageEl.className = `fixed top-4 right-4 px-4 py-2 rounded-lg text-white font-medium z-50 ${
            type === 'success' ? 'bg-green-500' : 'bg-red-500'
        }`;
        messageEl.textContent = message;
        
        document.body.appendChild(messageEl);
        
        // Remove after 3 seconds
        setTimeout(() => {
            messageEl.remove();
        }, 3000);
    }
        
        
    </script>
</body>
</html>